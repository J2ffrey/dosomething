
      <%# Scripts for Calendar %>
      <script type="text/javascript">
        var getDateInterval = function(start_ms, end_ms) {
          if(start_ms==undefined||end_ms==undefined) return;
          var start_date = new Date(start_ms);
          var end_date = new Date(end_ms);
          var start_str = "{0}.{1}.{2}".format(
            start_date.getFullYear(),
            (start_date.getMonth()<9?"0":"") + (start_date.getMonth()+1),
            (start_date.getDate()<10?"0":"") + start_date.getDate()
          );
          if(start_date.getFullYear()==end_date.getFullYear()) {
            if(start_date.getMonth()==end_date.getMonth()) {
              if(start_date.getDate()==end_date.getDate()) return start_str
              else return start_str + "~{0}".format(
                (end_date.getDate()<10?"0":"") + end_date.getDate()
              );
            } else return start_str + "~{0}.{1}".format(
              (end_date.getMonth()<9?"0":"") + (end_date.getMonth()+1),
              (end_date.getDate()<10?"0":"") + end_date.getDate()
            );
          } else return start_str + "~{0}.{1}.{2}".format(
            end_date.getFullYear(),
            (end_date.getMonth()<9?"0":"") + (end_date.getMonth()+1),
            (end_date.getDate()<10?"0":"") + end_date.getDate()
          );
        }
        $(document).ready(function(){
          $.when(
            $.getScript( "/calendar/components/underscore/underscore-min.js" ),
            $.getScript( "/calendar/components/bootstrap3/js/bootstrap.min.js" ),
            $.getScript( "/calendar/js/calendar.js" ),
            $.getScript( "/calendar/js/language/ko-KR.js" ),
            $.Deferred(function( deferred ){
                $( deferred.resolve );
            })
          ).done(function(){
            var class_color = {
              "event-important" : "#fae3e3",
              "event-warning"   : "#fdf1ba",
              "event-info"      : "#d1e8ff",
              "event-inverse"   : "#c1c1c1",
              "event-success"   : "#caffca",
              "event-special"   : "#ffe6ff"
            }
            var options = {
              view: "month",
              tmpl_path: "/calendar/tmpls/",
              // language: "ko-KR",
              events_source: "/schedule/get_events",
              onAfterEventsLoad: function(events) {
                if(!events) return;
                var list = $('#event-list');
                list.html('');
                var now = new Date().getTime();
                var days = 24*60*60*1000;
                $.each(events, function(key, val) {
                  var start = new Date(val.start).getTime();
                  var finish = new Date(val.end).getTime();
                  if(!(now - 7*days <= finish && start <= now + 14*days)) return;
                  if(now-7*days <= finish && finish <= now) val.class = "event-inverse";
                  val.end -= 1; // exclude finish moment
                  newElem = $("<tr></tr>").addClass("schedule_table_row");
                  newElem.css("background-color", class_color[val.class] || "#dddddd");
                  $("<td></td>").css("text-align","center").html(getDateInterval(val.start, val.end)).appendTo(newElem);
                  $("<td></td>").css("text-align","left")
                    .html( $("<a></a>").attr("href", "/schedule/event/" + val.id).html(val.title) )
                    .appendTo(newElem);
                  newElem.appendTo(list);
                });
              },
              onAfterViewLoad: function(view) {
                $('#calendar-title').text(this.getTitle());
                $('.btn-group button').removeClass('active');
                $('button[data-calendar-view="' + view + '"]').addClass('active');
              },
              first_day: 2,
              format12: false,
              weekbox: false,
              display_week_numbers: false
            };
            var calendar = $("#calendar").calendar(options);
            $('.btn-group button[data-calendar-nav]').each(function() {
              var $this = $(this);
              $this.click(function() {
                calendar.navigate($this.data('calendar-nav'));
              });
            });
            $('.btn-group button[data-calendar-view]').each(function() {
              var $this = $(this);
              $this.click(function() {
                calendar.view($this.data('calendar-view'));
              });
            });
          });
        });
      </script>